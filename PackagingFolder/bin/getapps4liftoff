#!/boot/system/bin/bash
tempfile=$(finddir B_COMMON_TEMP_DIRECTORY)/getapp_tmp
settingsfile=$(finddir B_COMMON_TEMP_DIRECTORY)/apps4liftoff.txt
patternfile=$(finddir B_COMMON_TEMP_DIRECTORY)/greppattern
rm -f $tempfile; rm -f $settingsfile; rm -f $patternfile

echo /boot/system/apps/ > $patternfile
echo /boot/home/config/apps >> $patternfile
echo /boot/home/config/non-packaged/apps/ >> $patternfile
echo /boot/system/non-packaged/apps/ >> $patternfile
echo /boot/system/preferences/ >> $patternfile
echo /boot/home/config/preferences/ >> $patternfile
echo /boot/home/config/non-packaged/preferences/ >> $patternfile
echo /boot/system/non-packaged/preferences/ >> $patternfile

query -efa "(name=="*")&&(BEOS:APP_SIG=="application*")" | grep -F -f $patternfile> $tempfile

#sort $tempfile > $settingsfile
awk -F/ '{ print $NF, $0 }' $tempfile | sort -k1 -f > $settingsfile

rm -f $tempfile
rm -f $patternfile
